@{
    ViewBag.Title = ViewBag.Filial;
}

<input type="hidden" id="period" name="period" value="@(ViewBag.Period)">

<nav class="navbar navbar-default">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">@ViewBag.Filial</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
<!--        <li class="active"><a href="#">@ViewBag.Login<span class="sr-only">(current)</span></a></li> -->
<!--        <li><a href="#">Link</a></li> -->
@if (ViewBag.Mode == "CONTROL" || ViewBag.Mode == "MANAGE") 
		{
        <li class="dropdown active">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">@ViewBag.Login <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
			  @if (ViewBag.Mode == "MANAGE") {
				<li><a href="#" data-toggle="modal" data-target="#myModalChangePassword" data-toggle="popover" data-placement="top" >Смена пароля</a></li>
				<li class="divider"></li>
			  }
				<li><a href="#" onclick="StopRadiusSession()">Сброс сессии</a></li>
				<li><a href="#" onclick="CheckProfile()">Перезагрузка профиля</a></li>

          </ul>
        </li>
		}
		else
		{
		 <li class="active"><a href="#">@ViewBag.Login<span class="sr-only">(current)</span></a></li>
		}
      </ul>
      <form class="navbar-form navbar-left" role="search">
        <div class="form-group">
          <input type="text" name="login" value="@(ViewBag.Login)" class="form-control" id="login" placeholder="Введите логин">
		  <input type="text" class="form-control tcal" readonly="readonly" value="@(ViewBag.DateBgn)" id="datebgn" placeholder="Дата начала периода" style="cursor: pointer">
		  <input type="text" class="form-control tcal" readonly="readonly" value="@(ViewBag.DateEnd)" id="dateend" placeholder="Дата конца периода" style="cursor: pointer">		  
        </div>
        

		<div class="btn-group">
		  <input type="button" name="submit" class="btn btn-default" value="Получить данные" onclick="SubmitSearch(0)"/>
		  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
			<span class="caret"></span>
			<span class="sr-only">Toggle Dropdown</span>
		  </button>
		  <ul class="dropdown-menu" role="menu">
			<li><a href="#" onclick="SubmitSearch(1*24*60)">1 день</a></li>
			<li><a href="#" onclick="SubmitSearch(3*24*60)">3 дня</a></li>
			<li><a href="#" onclick="SubmitSearch(7*24*60)">7 дней</a></li>
			<li><a href="#" onclick="SubmitSearch(30*24*60)">30 дней</a></li>
		  </ul>
		</div>

      </form>
<!--
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#">Link</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="#">Action</a></li>
            <li><a href="#">Another action</a></li>
            <li><a href="#">Something else here</a></li>
            <li class="divider"></li>
            <li><a href="#">Separated link</a></li>
          </ul>
        </li>
      </ul>
-->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
	
<!--
<div class="row">
	<div class="col-xs-12">
		
		@ViewBag.Filial 

		@if (ViewBag.Mode == "CONTROL" || ViewBag.Mode == "MANAGE") 
		{
		
			<div class="btn-group">
			  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
				@ViewBag.Login <span class="caret"></span>
			  </button>
			  <ul class="dropdown-menu" role="menu">
			  @if (ViewBag.Mode == "MANAGE") {
				<li><a href="#" data-toggle="modal" data-target="#myModalChangePassword" data-toggle="popover" data-placement="top" >Смена пароля</a></li>
			  }
				<li><a href="#" onclick="StopRadiusSession()">Сброс сессии</a></li>
				<li><a href="#" onclick="CheckProfile()">Перезагрузка профиля</a></li>			
			  </ul>
			</div>
		}
		else
		{
			@ViewBag.Login
		}
	</div>
</div>

-->

<!--
<hr/>	

<div class="container-fluid">
	
	<div class="row">
		<div class="col-xs-3">
			<input type="text" name="login" value="@(ViewBag.Login)" class="form-control" id="login" placeholder="Введите логин">
		</div>
		<div class="col-xs-3">
			<input type="text" class="form-control tcal" readonly="readonly" value="@(ViewBag.DateBgn)" id="datebgn" placeholder="Дата начало периода" style="cursor: pointer">
		</div>
		<div class="col-xs-3">
			<input type="text" class="form-control tcal" readonly="readonly" value="@(ViewBag.DateEnd)" id="dateend" placeholder="Дата конца периода" style="cursor: pointer">
		</div>
		<div class="cal-xs-3">
			<input type="button" name="submit" class="btn btn-default" value="Получить данные" onclick="SubmitSearch(0)"/>
		</div>
	</div>
	<hr/>
	<div class="row">
		<div class="col-xs-3 ">
		</div>
		<div class="col-xs-9 ">
			<div class="btn-group" role="group" aria-label="...">
				  <button onclick="SubmitSearch(1*24*60)" type="button" class="btn btn-default">1 день</button>
				  <button onclick="SubmitSearch(3*24*60)" type="button" class="btn btn-default">3 дня</button>
				  <button onclick="SubmitSearch(7*24*60)" type="button" class="btn btn-default">1 неделя</button>
				  <button onclick="SubmitSearch(30*24*60)" type="button" class="btn btn-default">1 месяц</button>
			</div>
		</div>
	</div>
-->
	<div id="alert-danger-login" class="alert alert-danger" role="alert">
		Укажите логин
	</div>
	
	<div id="alert-danger-datebgn" class="alert alert-danger" role="alert">
		Укажите дату начало периода
	</div>
	
	<div id="alert-danger-dateend" class="alert alert-danger" role="alert">
		Укажите дату конца периода
	</div>

	
	<div role="tabpanel">
		<ul id="myTab" class="nav nav-tabs" role="tablist">
			<li role="presentation" class="active"><a href="#autorization" aria-controls="autorization" role="tab" data-toggle="tab">ОШИБКИ АВТОРИЗАЦИИ</a></li>
			<li role="presentation"><a href="#sessions" aria-controls="sessions" role="tab" data-toggle="tab">СПИСОК СЕССИЙ</a></li>		
			<li role="presentation"><a href="#traffic" aria-controls="traffic" role="tab" data-toggle="tab">ТРАФИК</a></li>		
		</ul>

		<div class="tab-content">
			<div role="tabpanel" class="tab-pane active" id="autorization"></div>
			<div role="tabpanel" class="tab-pane" id="sessions"></div>
			<div role="tabpanel" class="tab-pane" id="traffic"></div>
		</div>
	</div>

	<script>
		$(function () {
		  $('[data-toggle="popover"]').tooltip()
		});
		$('#myTab a').click(function (e) {
		  e.preventDefault()
		  $(this).tab('show')
		});
		function SubmitSearch(interval) {
			var isValid = true;
			if (interval > 0) {
				isValid = ValidationLogin(true);
			} 
			else {
				isValid = Validation(true);
			}
			if (isValid == true) {
				$('#autorization').text("Загрузка...");
				$('#sessions').text("Загрузка...");
				$('#traffic').text("Загрузка...");

				$.get('@Url.Action("GetAccessByLogin", "Radius")', { filial:"1", login:document.getElementById("login").value, datebgn:document.getElementById("datebgn").value, dateend:document.getElementById("dateend").value, interval:interval }, function(data) { 				
					document.getElementById("autorization").innerHTML = data;
				});
				$.get('@Url.Action("GetSessionsByLogin", "Radius")', { filial:"1", login:document.getElementById("login").value, datebgn:document.getElementById("datebgn").value, dateend:document.getElementById("dateend").value, interval:interval }, function(data) { 				
					document.getElementById("sessions").innerHTML = data;
				});
				$.get('@Url.Action("GetTrafficByLogin", "Radius")', { filial:"1", login:document.getElementById("login").value, datebgn:document.getElementById("datebgn").value, dateend:document.getElementById("dateend").value, interval:interval }, function(data) { 				
					document.getElementById("traffic").innerHTML = data;
				});
			}
		}

		function ChangePassword() {
			$.get('@Url.Action("ChangePassword", "Radius")', { filial:"1", login:document.getElementById("login").value, new_pass:document.getElementById("exampleInputNewPass").value, old_pass:document.getElementById("exampleInputOldPass").value,  pin_code:document.getElementById("exampleInputPin").value  }, function(data) { 				
					alert( data );
			});
		}

		function StopRadiusSession() {
			$.get('@Url.Action("StopRadiusSession", "Radius")', { filial:"1", login:document.getElementById("login").value  }, function(data) { 				
					alert( data );
			});
		}

		function CheckProfile() {
			$.get('@Url.Action("CheckProfile", "Radius")', { filial:"1", login:document.getElementById("login").value  }, function(data) { 				
					alert( data );
			});
		}
	</script>

</div>

<!-- Modal Change Password -->
<div class="modal fade" id="myModalChangePassword" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Смена пароля пользователя</h4>
      </div>
      <div class="modal-body">
		  <div class="form-group">
			<label for="exampleInputNewPass">Новый пароль</label>
			<input type="text" class="form-control" id="exampleInputNewPass" placeholder="Новый пароль">
		  </div>
		  <div class="form-group">
			<label for="exampleInputOldPass">Старый пароль</label>
			<input type="text" class="form-control" id="exampleInputOldPass" placeholder="Старый пароль">
		  </div>
		  <div class="form-group">
			<label for="exampleInputPin">ПИН</label>
			<input type="text" class="form-control" id="exampleInputPin" placeholder="ПИН">
		  </div>
      </div>
      <div class="modal-footer">
		<button type="button" onclick="ChangePassword()" class="btn btn-primary" data-dismiss="modal">Сменить</button>        
        <button type="button" class="btn btn-default" data-dismiss="modal">Отмена</button>        
      </div>
    </div>
  </div>
</div>
